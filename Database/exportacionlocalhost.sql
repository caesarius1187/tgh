-- ---------------------------------------------
-- Script de carga para PostgreSQL (esquema tgh)
-- Convertido desde exportacionlocalhost.sql (MySQL)
-- ---------------------------------------------

BEGIN;

SET client_encoding = 'UTF8';
SET standard_conforming_strings = ON;
SET check_function_bodies = FALSE;
SET client_min_messages TO WARNING;

-- Limpiar tablas existentes si ya existen
DROP TABLE IF EXISTS auditoria_logs CASCADE;
DROP TABLE IF EXISTS contactos_emergencia CASCADE;
DROP TABLE IF EXISTS datos_vitales CASCADE;
DROP TABLE IF EXISTS datos_personales CASCADE;
DROP TABLE IF EXISTS sesiones_usuarios CASCADE;
DROP TABLE IF EXISTS usuarios CASCADE;
DROP TABLE IF EXISTS pulseras CASCADE;

-- Tabla: pulseras
CREATE TABLE pulseras (
    id          INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    serial      VARCHAR(50) NOT NULL,
    is_active   BOOLEAN NOT NULL DEFAULT FALSE,
    public_url  VARCHAR(255),
    created_at  TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    updated_at  TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

CREATE UNIQUE INDEX idx_pulseras_serial ON pulseras (serial);
CREATE UNIQUE INDEX idx_pulseras_public_url ON pulseras (public_url);
CREATE INDEX idx_pulseras_is_active ON pulseras (is_active);

-- Tabla: usuarios
CREATE TABLE usuarios (
    id            INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username      VARCHAR(50) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    pulsera_id    INTEGER,
    is_active     BOOLEAN NOT NULL DEFAULT TRUE,
    last_login    TIMESTAMP WITHOUT TIME ZONE,
    created_at    TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    updated_at    TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    CONSTRAINT usuarios_pulsera_fk
        FOREIGN KEY (pulsera_id) REFERENCES pulseras (id) ON DELETE SET NULL
);

CREATE UNIQUE INDEX idx_usuarios_username ON usuarios (username);
CREATE UNIQUE INDEX idx_usuarios_pulsera_id ON usuarios (pulsera_id);
CREATE INDEX idx_usuarios_is_active ON usuarios (is_active);
CREATE INDEX idx_usuarios_last_login ON usuarios (last_login);

-- Tabla: auditoria_logs
CREATE TABLE auditoria_logs (
    id                INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    usuario_id        INTEGER,
    evento            VARCHAR(100) NOT NULL,
    descripcion       TEXT,
    ip_address        VARCHAR(45),
    user_agent        TEXT,
    datos_adicionales JSONB,
    created_at        TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    CONSTRAINT auditoria_logs_usuario_fk
        FOREIGN KEY (usuario_id) REFERENCES usuarios (id) ON DELETE SET NULL
);

CREATE INDEX idx_auditoria_logs_usuario_id ON auditoria_logs (usuario_id);
CREATE INDEX idx_auditoria_logs_evento ON auditoria_logs (evento);
CREATE INDEX idx_auditoria_logs_created_at ON auditoria_logs (created_at);
CREATE INDEX idx_auditoria_logs_ip_address ON auditoria_logs (ip_address);

-- Tabla: contactos_emergencia
CREATE TABLE contactos_emergencia (
    id           INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    usuario_id   INTEGER NOT NULL,
    nombre       VARCHAR(100) NOT NULL,
    telefono     VARCHAR(20) NOT NULL,
    relacion     VARCHAR(50),
    es_principal BOOLEAN DEFAULT FALSE,
    orden        INTEGER DEFAULT 0,
    is_active    BOOLEAN DEFAULT TRUE,
    created_at   TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    updated_at   TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    CONSTRAINT contactos_emergencia_usuario_fk
        FOREIGN KEY (usuario_id) REFERENCES usuarios (id) ON DELETE CASCADE
);

CREATE INDEX idx_contactos_usuario ON contactos_emergencia (usuario_id);
CREATE INDEX idx_contactos_usuario_principal ON contactos_emergencia (usuario_id, es_principal);
CREATE INDEX idx_contactos_usuario_orden ON contactos_emergencia (usuario_id, orden);
CREATE INDEX idx_contactos_is_active ON contactos_emergencia (is_active);

-- Tabla: datos_personales
CREATE TABLE datos_personales (
    id               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    usuario_id       INTEGER NOT NULL,
    nombre           VARCHAR(100) NOT NULL,
    apellido         VARCHAR(100) NOT NULL,
    fecha_nacimiento DATE NOT NULL,
    foto_url         VARCHAR(500),
    telefono         VARCHAR(20),
    email            VARCHAR(100),
    created_at       TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    updated_at       TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    CONSTRAINT datos_personales_usuario_fk
        FOREIGN KEY (usuario_id) REFERENCES usuarios (id) ON DELETE CASCADE,
    CONSTRAINT datos_personales_usuario_uk UNIQUE (usuario_id)
);

CREATE INDEX idx_datos_personales_nombre_apellido ON datos_personales (nombre, apellido);
CREATE INDEX idx_datos_personales_email ON datos_personales (email);

-- Tabla: datos_vitales
CREATE TABLE datos_vitales (
    id                    INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    usuario_id            INTEGER NOT NULL,
    alergias              TEXT,
    medicacion            TEXT,
    enfermedades_cronicas TEXT,
    grupo_sanguineo       VARCHAR(10),
    grupo_sanguineo_url   VARCHAR(500),
    peso                  NUMERIC(5,2),
    altura                NUMERIC(5,2),
    observaciones_medicas TEXT,
    created_at            TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    updated_at            TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    CONSTRAINT datos_vitales_usuario_fk
        FOREIGN KEY (usuario_id) REFERENCES usuarios (id) ON DELETE CASCADE,
    CONSTRAINT datos_vitales_usuario_uk UNIQUE (usuario_id)
);

CREATE INDEX idx_datos_vitales_grupo_sanguineo ON datos_vitales (grupo_sanguineo);

-- Tabla: sesiones_usuarios
CREATE TABLE sesiones_usuarios (
    id            INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    usuario_id    INTEGER NOT NULL,
    token_hash    VARCHAR(255) NOT NULL,
    expires_at    TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    ip_address    VARCHAR(45),
    user_agent    TEXT,
    is_active     BOOLEAN DEFAULT TRUE,
    last_activity TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    created_at    TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    CONSTRAINT sesiones_usuarios_usuario_fk
        FOREIGN KEY (usuario_id) REFERENCES usuarios (id) ON DELETE CASCADE
);

CREATE INDEX idx_sesiones_usuario ON sesiones_usuarios (usuario_id);
CREATE INDEX idx_sesiones_token_hash ON sesiones_usuarios (token_hash);
CREATE INDEX idx_sesiones_expires_at ON sesiones_usuarios (expires_at);
CREATE INDEX idx_sesiones_is_active ON sesiones_usuarios (is_active);
CREATE INDEX idx_sesiones_last_activity ON sesiones_usuarios (last_activity);

-- Inserción de datos en el orden correcto

INSERT INTO pulseras (id, serial, is_active, public_url, created_at, updated_at) VALUES
    (1, 'TGH001', FALSE, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (2, 'TGH002', FALSE, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (3, 'TGH003', FALSE, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (4, 'TGH004', FALSE, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (5, 'TGH005', TRUE, 'http://localhost:3000/nfc/TGH005', '2025-09-24 03:03:05', '2025-09-24 03:21:32');

ALTER SEQUENCE pulseras_id_seq RESTART WITH 6;

INSERT INTO usuarios (id, username, password_hash, pulsera_id, is_active, last_login, created_at, updated_at) VALUES
    (1, 'admin', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NULL, TRUE, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (2, 'testuser', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NULL, TRUE, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (3, 'caesarius', '$2a$12$E3/b6CPrsSK.4ZeIqv1sTe4QPCW2.gBEa0tBkoWqUIQW7SuV.azYC', 5, TRUE, '2025-11-08 15:19:54', '2025-09-24 03:21:32', '2025-11-08 15:19:54');

ALTER SEQUENCE usuarios_id_seq RESTART WITH 4;

INSERT INTO auditoria_logs (id, usuario_id, evento, descripcion, ip_address, user_agent, datos_adicionales, created_at) VALUES
    (1, 1, 'registro_usuario', 'Usuario administrador creado', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)', NULL, '2025-09-24 03:03:05'),
    (2, 2, 'registro_usuario', 'Usuario de prueba creado', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)', NULL, '2025-09-24 03:03:05'),
    (3, 1, 'login', 'Inicio de sesión exitoso', '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)', NULL, '2025-09-24 03:03:05'),
    (4, NULL, 'login_failed', 'Intento de login fallido para usuario: testuser', '::1', NULL, '{"attempts": 1, "username": "testuser"}'::jsonb, '2025-09-24 03:16:30'),
    (5, 2, 'login_failed', 'Intento de login con contraseña incorrecta: testuser', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"reason": "invalid_password", "username": "testuser"}'::jsonb, '2025-09-24 03:16:30'),
    (6, NULL, 'login_failed', 'Intento de login fallido para usuario: testuser', '::1', NULL, '{"attempts": 1, "username": "testuser"}'::jsonb, '2025-09-24 03:16:40'),
    (7, 2, 'login_failed', 'Intento de login con contraseña incorrecta: testuser', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"reason": "invalid_password", "username": "testuser"}'::jsonb, '2025-09-24 03:16:40'),
    (8, NULL, 'login_failed', 'Intento de login fallido para usuario: admin', '::1', NULL, '{"attempts": 1, "username": "admin"}'::jsonb, '2025-09-24 03:16:49'),
    (9, 1, 'login_failed', 'Intento de login con contraseña incorrecta: admin', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"reason": "invalid_password", "username": "admin"}'::jsonb, '2025-09-24 03:16:49'),
    (10, NULL, 'serial_validation_failed', 'Intento de validación con serial inexistente: TGH00022', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"reason": "serial_not_found", "serial": "TGH00022"}'::jsonb, '2025-09-24 03:17:07'),
    (11, NULL, 'serial_validation_success', 'Validación exitosa de serial: TGH005', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"serial": "TGH005"}'::jsonb, '2025-09-24 03:17:26'),
    (12, NULL, 'serial_validation_success', 'Validación exitosa de serial: TGH005', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"serial": "TGH005"}'::jsonb, '2025-09-24 03:21:06'),
    (13, 3, 'user_registered', 'Usuario registrado exitosamente: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"serial": "TGH005", "username": "caesarius", "pulseraId": 5}'::jsonb, '2025-09-24 03:21:33'),
    (14, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:21:33'),
    (15, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:21:33'),
    (16, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:24:46'),
    (17, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:24:46'),
    (18, NULL, 'user_data_update_error', 'Error interno durante actualización de datos', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"error": "(0 , _lib_db_utils__WEBPACK_IMPORTED_MODULE_2__.executeQuery) is not a function"}'::jsonb, '2025-09-24 03:26:43'),
    (19, NULL, 'user_data_update_error', 'Error interno durante actualización de datos', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"error": "(0 , _lib_db_utils__WEBPACK_IMPORTED_MODULE_2__.executeQuery) is not a function"}'::jsonb, '2025-09-24 03:27:01'),
    (20, NULL, 'user_data_update_error', 'Error interno durante actualización de datos', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"error": "(0 , _lib_db_utils__WEBPACK_IMPORTED_MODULE_2__.executeQuery) is not a function"}'::jsonb, '2025-09-24 03:27:31'),
    (21, 3, 'user_data_updated', 'Datos personales actualizados: Augusto Cesar Guerrero', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"tipo": "personal", "datos": {"email": "coto1187@gmail.com", "nombre": "Augusto Cesar", "apellido": "Guerrero", "telefono": "+543874756509", "fecha_nacimiento": "1987-11-23"}}'::jsonb, '2025-09-24 03:28:59'),
    (22, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:28:59'),
    (23, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:29:04'),
    (24, 3, 'user_data_updated', 'Datos personales actualizados: Augusto Cesar Guerrero', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"tipo": "personal", "datos": {"email": "coto1187@gmail.com", "nombre": "Augusto Cesar", "apellido": "Guerrero", "telefono": "+543874756509", "fecha_nacimiento": "2025-09-17"}}'::jsonb, '2025-09-24 03:29:15'),
    (25, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:29:15'),
    (26, 3, 'user_data_updated', 'Datos personales actualizados: Augusto Cesar Guerrero', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"tipo": "personal", "datos": {"email": "coto1187@gmail.com", "nombre": "Augusto Cesar", "apellido": "Guerrero", "telefono": "+543874756509", "fecha_nacimiento": "2025-09-17"}}'::jsonb, '2025-09-24 03:29:30'),
    (27, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:29:30'),
    (28, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:31:11'),
    (29, 3, 'user_data_updated', 'Datos personales actualizados: Augusto Cesar Guerrero', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"tipo": "personal", "datos": {"email": "coto1187@gmail.com", "nombre": "Augusto Cesar", "apellido": "Guerrero", "telefono": "+543874756509", "fecha_nacimiento": "1987-11-23"}}'::jsonb, '2025-09-24 03:31:34'),
    (30, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:31:34'),
    (31, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:31:37'),
    (32, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:31:42'),
    (33, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:33:05'),
    (34, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:35:18'),
    (35, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:36:41'),
    (36, 3, 'user_data_updated', 'Datos personales actualizados: Augusto Cesar Guerrero', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"tipo": "personal", "datos": {"email": "coto1187@gmail.com", "nombre": "Augusto Cesar", "apellido": "Guerrero", "telefono": "+543874756509", "fecha_nacimiento": "1987-11-24"}}'::jsonb, '2025-09-24 03:36:52'),
    (37, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:36:52'),
    (38, 3, 'user_data_updated', 'Datos vitales actualizados: grupo A+', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"tipo": "vitales", "datos": {"peso": 88, "altura": 168, "alergias": "nada1", "medicacion": "nada2", "grupo_sanguineo": "A+", "enfermedades_cronicas": "nada3"}}'::jsonb, '2025-09-24 03:37:19'),
    (39, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 03:37:19'),
    (40, 3, 'login_success', 'Login exitoso: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"userId": 3, "username": "caesarius"}'::jsonb, '2025-09-24 12:05:03'),
    (41, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 12:05:08'),
    (42, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-09-24 12:05:08'),
    (43, 3, 'login_success', 'Login exitoso: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"userId": 3, "username": "caesarius"}'::jsonb, '2025-11-08 15:19:54'),
    (44, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:19:58'),
    (45, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:19:58'),
    (46, NULL, 'file_upload_error', 'Error interno durante subida de archivo', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"error": "(0 , _lib_db_utils__WEBPACK_IMPORTED_MODULE_2__.executeQuery) is not a function"}'::jsonb, '2025-11-08 15:20:54'),
    (47, NULL, 'file_upload_error', 'Error interno durante subida de archivo', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"error": "(0 , _lib_db_utils__WEBPACK_IMPORTED_MODULE_2__.executeQuery) is not a function"}'::jsonb, '2025-11-08 15:21:03'),
    (48, 3, 'file_upload_success', 'Archivo foto subido exitosamente', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"tipo": "foto", "fileUrl": "/uploads/3_foto_1762615492114.jpg", "fileName": "3_foto_1762615492114.jpg", "fileSize": 75635, "mimeType": "image/jpeg"}'::jsonb, '2025-11-08 15:24:52'),
    (49, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:24:53'),
    (50, 3, 'file_upload_success', 'Archivo foto subido exitosamente', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"tipo": "foto", "fileUrl": "/uploads/3_foto_1762615502189.webp", "fileName": "3_foto_1762615502189.webp", "fileSize": 53374, "mimeType": "image/webp"}'::jsonb, '2025-11-08 15:25:02'),
    (51, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:25:02'),
    (52, 3, 'file_upload_success', 'Archivo certificado_grupo_sanguineo subido exitosamente', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"tipo": "certificado_grupo_sanguineo", "fileUrl": "/uploads/3_certificado_grupo_sanguineo_1762615511644.jpg", "fileName": "3_certificado_grupo_sanguineo_1762615511644.jpg", "fileSize": 157187, "mimeType": "image/jpeg"}'::jsonb, '2025-11-08 15:25:11'),
    (53, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:25:11'),
    (54, 3, 'file_upload_success', 'Archivo certificado_grupo_sanguineo subido exitosamente', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"tipo": "certificado_grupo_sanguineo", "fileUrl": "/uploads/3_certificado_grupo_sanguineo_1762615522665.jpg", "fileName": "3_certificado_grupo_sanguineo_1762615522665.jpg", "fileSize": 75635, "mimeType": "image/jpeg"}'::jsonb, '2025-11-08 15:25:22'),
    (55, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:25:22'),
    (56, 3, 'file_upload_success', 'Archivo certificado_grupo_sanguineo subido exitosamente', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"tipo": "certificado_grupo_sanguineo", "fileUrl": "/uploads/3_certificado_grupo_sanguineo_1762615897199.jpg", "fileName": "3_certificado_grupo_sanguineo_1762615897199.jpg", "fileSize": 45437, "mimeType": "image/jpeg"}'::jsonb, '2025-11-08 15:31:37'),
    (57, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:31:38'),
    (58, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:34:15'),
    (59, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:34:15'),
    (60, 3, 'user_data_updated', 'Nuevo contacto de emergencia agregado: mama', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"tipo": "contacto", "datos": {"nombre": "mama", "relacion": "mami", "telefono": "3874654654", "es_principal": true}}'::jsonb, '2025-11-08 15:36:25'),
    (61, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 15:36:26'),
    (62, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 17:02:50'),
    (63, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 17:02:50'),
    (64, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 17:03:03'),
    (65, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 17:56:27'),
    (66, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 18:09:01'),
    (67, NULL, 'nfc_access_failed', 'Intento de acceso NFC con serial inexistente o inactivo: undefined', '::1', 'node', '{"reason": "serial_not_found_or_inactive", "serial": "undefined"}'::jsonb, '2025-11-08 18:09:08'),
    (68, 3, 'user_data_accessed', 'Acceso a datos personales: caesarius', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', '{"username": "caesarius"}'::jsonb, '2025-11-08 18:18:32'),
    (69, NULL, 'nfc_access_failed', 'Intento de acceso NFC con serial inexistente o inactivo: undefined', '::1', 'node', '{"reason": "serial_not_found_or_inactive", "serial": "undefined"}'::jsonb, '2025-11-08 18:18:48'),
    (70, NULL, 'nfc_access_failed', 'Intento de acceso NFC con serial inexistente o inactivo: undefined', '::1', 'node', '{"reason": "serial_not_found_or_inactive", "serial": "undefined"}'::jsonb, '2025-11-08 18:18:48'),
    (71, NULL, 'nfc_access_failed', 'Intento de acceso NFC con serial inexistente o inactivo: undefined', '::1', 'node', '{"reason": "serial_not_found_or_inactive", "serial": "undefined"}'::jsonb, '2025-11-08 18:18:48');

ALTER SEQUENCE auditoria_logs_id_seq RESTART WITH 72;

INSERT INTO contactos_emergencia (id, usuario_id, nombre, telefono, relacion, es_principal, orden, is_active, created_at, updated_at) VALUES
    (1, 1, 'Contacto Emergencia Admin', '+1111111111', 'Familiar', TRUE, 1, TRUE, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (2, 2, 'Mamá', '+2222222222', 'Madre', TRUE, 1, TRUE, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (3, 2, 'Papá', '+3333333333', 'Padre', FALSE, 2, TRUE, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (4, 2, 'Hermano', '+4444444444', 'Hermano', FALSE, 3, TRUE, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (5, 3, 'mama', '3874654654', 'mami', TRUE, 1, TRUE, '2025-11-08 15:36:25', '2025-11-08 15:36:25');

ALTER SEQUENCE contactos_emergencia_id_seq RESTART WITH 6;

INSERT INTO datos_personales (id, usuario_id, nombre, apellido, fecha_nacimiento, foto_url, telefono, email, created_at, updated_at) VALUES
    (1, 1, 'Administrador', 'Sistema', '1990-01-01', NULL, '+1234567890', 'admin@tgh.com', '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (2, 2, 'Usuario', 'Prueba', '1985-05-15', NULL, '+0987654321', 'test@tgh.com', '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (3, 3, 'Augusto Cesar', 'Guerrero', '1987-11-24', '/uploads/3_foto_1762615502189.webp', '+543874756509', 'coto1187@gmail.com', '2025-09-24 03:28:59', '2025-11-08 15:25:02');

ALTER SEQUENCE datos_personales_id_seq RESTART WITH 4;

INSERT INTO datos_vitales (id, usuario_id, alergias, medicacion, enfermedades_cronicas, grupo_sanguineo, grupo_sanguineo_url, peso, altura, observaciones_medicas, created_at, updated_at) VALUES
    (1, 1, 'Ninguna', 'Ninguna', 'Ninguna', 'O+', NULL, 70.50, 175.00, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (2, 2, 'Penicilina', 'Ninguna', 'Diabetes tipo 2', 'A+', NULL, 80.20, 180.00, NULL, '2025-09-24 03:03:05', '2025-09-24 03:03:05'),
    (3, 3, 'nada1', 'nada2', 'nada3', 'A+', '/uploads/3_certificado_grupo_sanguineo_1762615897199.jpg', 88.00, 168.00, NULL, '2025-09-24 03:37:19', '2025-11-08 15:31:37');

ALTER SEQUENCE datos_vitales_id_seq RESTART WITH 4;

INSERT INTO sesiones_usuarios (id, usuario_id, token_hash, expires_at, ip_address, user_agent, is_active, last_activity, created_at) VALUES
    (1, 3, '$2a$12$qH1H/.wcR3iHXZ1zFP3jKOIFTIR3AqEkc3yYTrJupf73NLJfy3ZKe', '2025-10-01 03:21:33', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', TRUE, '2025-09-24 03:21:33', '2025-09-24 03:21:33'),
    (2, 3, '$2a$12$2cpEtupXVkWx6NaaqQZDvuuVhtRJtjWV2HGXo5iuEsHPBu4ED2xcS', '2025-10-01 12:05:03', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', TRUE, '2025-09-24 12:05:03', '2025-09-24 12:05:03'),
    (3, 3, '$2a$12$xTYkKVYH6ZOmX6MlrgY8D.aHoqo7Vn7vEmn9jpUAuVTDK1Fs/k/xa', '2025-11-15 15:19:54', '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', TRUE, '2025-11-08 15:19:54', '2025-11-08 15:19:54');

ALTER SEQUENCE sesiones_usuarios_id_seq RESTART WITH 4;

COMMIT;

